<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>자식체인 · Tokamak Network Documents</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## 오퍼레이터, 사용자, 챌린저"/><meta name="docsearch:language" content="ko"/><meta property="og:title" content="자식체인 · Tokamak Network Documents"/><meta property="og:type" content="website"/><meta property="og:url" content="https://onther-tech.github.io/"/><meta property="og:description" content="## 오퍼레이터, 사용자, 챌린저"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/tokamak_favicon.svg"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/prism.css"/><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/ko"><img class="logo" src="/img/tokamak_white.png" alt="Tokamak Network Documents"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/ko/learn/basic/tokamak-network" target="_self">Docs</a></li><li class="siteNavGroupActive"><a href="/docs/ko/guides/getting-started/how-to-open-private-testnet-rootchain" target="_self">Getting Started</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>한국어</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/learn/advanced/child-chain">English</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>고급</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">배우기<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">기초</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/learn/basic/tokamak-network">토카막 네트워크</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/basic/enter-and-exit">상호운용성: 진입 &amp; 퇴장</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/basic/transaction-fee">편의성: 계정, 트랜잭션 수수료, 개발도구</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/basic/layer-2-solutions">비교: 다른 확장성 솔루션</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">고급</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/design-rationale">디자인 원칙</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/plasma-evm-architecture">Plasma EVM 아키텍처</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/root-chain">루트체인</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/ko/learn/advanced/child-chain">자식체인</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/continuous-rebase">Continuous Rebase</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/plasma-evm-smart-contracts">Plasma EVM 스마트 컨트랙트</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/advanced/examples-and-best-practices">요청 가능한 컨트랙트 예제</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">토큰경제</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/ton">TON</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/child-chain">자식체인과 스테이킹</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/token-supply">토큰 공급과 분배</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/powerton">파워톤</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/tx-fee">트랜잭션 수수료 정책</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/challenge">챌린지</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/learn/economics/glossary">파라미터 정리</a></li></ul></div></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">가이드<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">프라이빗 테스트넷 시작</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-open-private-testnet-rootchain">루트체인 설정</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-open-private-testnet-manually">자식체인 설정</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-open-private-testnet-puppeth">Puppeth 사용하여 부모-자식체인 설정</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">퍼블릭 테스트넷 연결</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-connect-public-testnet-prepare">연결 준비</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-connect-public-testnet-manually">직접 연결</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/how-to-connect-public-testnet-puppeth">Puppeth 사용하여 연결</a></li><li class="navListItem"><a class="navItem" href="/docs/ko/guides/public-testnets">퍼블릭 테스트넷 정보</a></li></ul></div><div class="navGroup subNavGroup"><h4 class="navGroupSubcategoryTitle">TON 스테이킹</h4><ul><li class="navListItem"><a class="navItem" href="/docs/ko/guides/getting-started/private-testnet-staking">프라이빗 네트워크 테스트</a></li></ul></div></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/onther-tech/docs.tokamak.network/edit/master/docs/learn/advanced/child-chain.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">자식체인</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="오퍼레이터-사용자-챌린저"></a><a href="#오퍼레이터-사용자-챌린저" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>오퍼레이터, 사용자, 챌린저</h2>
<h3><a class="anchor" aria-hidden="true" id="오퍼레이터"></a><a href="#오퍼레이터" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>오퍼레이터</h3>
<p><strong>오퍼레이터(Operator)</strong>는 자식체인을 운영하는 주체이다. 사용자들의 트랜잭션들을 블록 단위로 모아 실행하며, 이러한 블록들을 루트체인 컨트랙트에 제출한다. 오퍼레이터는 누구나 될 수 있으며, 하나의 자식체인에서 단일 혹은 다수의 오퍼레이터 모두 구성 가능하다.</p>
<h3><a class="anchor" aria-hidden="true" id="사용자"></a><a href="#사용자" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>사용자</h3>
<p><strong>사용자(User)</strong>는 오퍼레이터가 운영하는 자식체인을 사용하는 주체이며, 루트체인과 자식체인간에 자산과 상태를 이동시키는 주체이다. 사용자는 직접 노드를 운영하여 오퍼레이터의 자식체인 운영을 감시할 수 있으며, 문제가 발견될 경우 해당 자식체인에서 탈출하거나 챌린저가 되어 자산 안전성을 보장받을 수 있다.</p>
<h3><a class="anchor" aria-hidden="true" id="챌린저"></a><a href="#챌린저" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>챌린저</h3>
<p><strong>챌린저(Challenger)</strong>는 사전에 정의된 규칙에 어긋나는 행동을 오퍼레이터나 사용자가 범했을 경우 챌린지를 신청하여 이를 바로잡는 역할을 수행한다. 챌린저가 되기 위한 조건은 별도로 존재하지 않으며, 누구나 챌린저가 될 수 있다.</p>
<h2><a class="anchor" aria-hidden="true" id="블록과-에폭"></a><a href="#블록과-에폭" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>블록과 에폭</h2>
<p>자식체인의 블록은 세가지 종류의 블록으로 구성된다.</p>
<ul>
<li><strong>비요청블록(Non-Request Block; NRB)</strong></li>
<li><strong>요청블록(Request Block; RB)</strong></li>
<li><strong>탈출블록(Escape Block; EB)</strong></li>
</ul>
<p><strong>비요청블록</strong>은 기존의 일반적인 블록과 동일하다. 사용자들의 일반적인 트랜잭션들을 포함한다.</p>
<p><strong>요청블록</strong>은 말 그대로 오직 <a href="child-chain#요청">요청</a>만을 처리하는 블록이다. Enter 및 Exit 요청들이 처리된다.</p>
<p><strong>탈출블록</strong>은 매우 특수한 상황에서만 생성되는 블록이다. <a href="continuous-rebase">Continuous Rebase</a>의 경우 사용자들이 데이터 가용성을 확인하여 문제가 있을 경우 주기적으로 자식체인으로부터 탈출할 수 있는 기간을 제공하는데, 만약 이 때 사용자들이 탈출 요청(escape request)을 루트체인 컨트랙트에 제출하게 되면 탈출 블록이 생성되게 된다.</p>
<p><strong>에폭(epoch)</strong>은 여러개의 블록을 포함하는 하나의 주기이다. 에폭도 포함되는 블록의 종류에 따라 다음과 같이 3가지 종류의 에폭으로 구성된다.</p>
<ul>
<li><strong>에폭비요청에폭(Non-Request Epoch; NRE)</strong></li>
<li><strong>요청에폭(Request Epoch; RE)</strong></li>
<li><strong>탈출에폭(Escape Epoch; EE))</strong></li>
</ul>
<p><strong>에폭의 길이(length)</strong>는 해당 에폭에 포함된 블록의 수를 의미하며, 비요청에폭의 길이는 사전에 상수로 정의되기 때문에 변경되지 않는다. 요청에폭과 탈출에폭의 경우 사용자들의 제출한 요청 수에 따라 에폭에 포함되는 블록의 수가 달라질 수 있으므로 그 길이는 가변적인 변수가 된다.</p>
<p>단, 제네시스(genesis) 블록은 0번째 비요청에폭이며, 해당 에폭의 길이는 항상 1이다.</p>
<h2><a class="anchor" aria-hidden="true" id="블록-제출"></a><a href="#블록-제출" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>블록 제출</h2>
<p>오퍼레이터는 자식체인을 운영하며 블록을 루트체인 컨트랙트에 제출하게 된다. 이 때 루트체인 컨트랙트는 다음과 같이 오퍼레이터가 어느 종류의 에폭을 제출해야 하는지 지정하여 자식체인의 트랜잭션과 루트체인 컨트랙트에 제출된 요청들을 반영하게 된다.</p>
<ul>
<li>NRE#0 이후에 NRE#1이 위치한다.</li>
<li>NRE#N 이후에는 항상 RE#N+1 이 위치한다. 마찬가지로 RE#N 이후엔 NRE#N+1이 위치한다.</li>
<li>현재 에폭이 NRE#N 혹은 RE#N+1 일 때 제출된 요청은 RE#N+3에 반영된다. 만약 요청이 존재하지 않는다면 해당 RE의 길이는 0이다.</li>
</ul>
<p>요약하자면 비요청에폭 이후에는 요청에폭, 요청에폭 이후에는 비요청에폭이 오는 것이 기본적인 규칙이며, 요청은 바로 즉시 다음 요청 에폭에 포함되는 것이 아니라 그 다음 요청 에폭에 포함된다는 것이다.</p>
<p><img src="/docs/assets/learn_advanced_simple_rootchain.png" alt="simple rootchain"></p>
<p>루트체인 컨트랙트는 위 그림과 같이 두 종료의 블록을 제출 받기 위해 주기적으로 <code>AcceptNRB</code>, <code>AcceptRB</code> 상태로 변경된다. <code>AcceptNRB</code>는 오직 비요청블록만 제출될 수 있는 상태를 의미하며, <code>AcceptRB</code>는 요청블록만 제출될 수 있는 상태를 의미한다. 오퍼레이터는 이렇게 루트체인 컨트랙트의 상태에 따라 요청블록 혹은 비요청블록을 제출해야 한다. 여기서 유의해야 할 점은 설명의 편의를 위해 <a href="continuous-rebase">Continuous Rebase</a>에서 다루는 탈출 블록을 포함하지 않고 있다는 것이다.</p>
<p>오퍼레이터는 블록을 제출할 때 세 종류의 머클루트(merkle root)값인 <code>stateRoot</code>, <code>transactionsRoot</code>, <code>receiptsRoot</code>를 제출한다. 단, <code>transactionsRoot</code>만 제출하는 것이 가능한 상황도 있는데, 자세한 내용은 <a href="continuous-rebase">Continuous Rebase</a>에서 다룬다.</p>
<h2><a class="anchor" aria-hidden="true" id="요청과-요청-트랜잭션"></a><a href="#요청과-요청-트랜잭션" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>요청과 요청 트랜잭션</h2>
<h3><a class="anchor" aria-hidden="true" id="요청"></a><a href="#요청" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>요청</h3>
<p><strong>요청(request)</strong>는 사용자가 루트체인과 자식체인간에 자산 혹은 상태를 이동하기 위해 루트체인 컨트랙트에 제출하는 요청이다. 요청은 다음과 같은 4가지 종류로 나누어진다.</p>
<ul>
<li>진입요청(enter request): 루트체인에서 자식체인으로 자산이나 상태를 이동시키는 요청이다.</li>
<li>퇴장요청(exit request): 자식체인에서 루트체인으로 자산이나 상태를 이동시키는 요청이다.</li>
<li>탈출요청(escape request): 자식체인에서 루트체인으로 자산과 상태를 탈출시키고자 하는 요청이다. 데이터 가용성 문제가 발생되었을 경우 사용된다.</li>
<li>무효요청(undo request): 데이터 가용성 문제가 발생했을 때, 이미 제출한 진입 요청을무효로 하기 위해 사용되는 요청이다.</li>
</ul>
<p>이 때, 진입요청과 탈출요청은 요청블록에 포함되고, 탈출요청과 무효요청은 탈출블록에 포함된다.</p>
<p>모든 요청은 다음과 같은 파라미터로 구성된다.</p>
<ul>
<li><code>requestor</code>: 요청을 제출한 어카운트</li>
<li><code>to</code>: 루트체인에 배포된 요청가능한 컨트랙트의 주소</li>
<li><code>trieKey</code>: 요청의 식별자</li>
<li><code>trieValue</code>: 요청의 값</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="요청-트랜잭션"></a><a href="#요청-트랜잭션" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>요청 트랜잭션</h3>
<p>요청은 자식체인에서 <strong>요청 트랜잭션(request transaction)</strong>의 형태로 반영된다. 요청 트랜잭션은 다음과 같이 구성된다.</p>
<ul>
<li><code>sender</code>: 널-계정(NULL_ADDRESS)</li>
<li><code>to</code>: 자식 체인에 배포된 요청가능한 컨트랙트의 주소</li>
<li><code>value</code>: 0</li>
<li><code>function signature</code>: 요청가능한 컨트랙트의 함수를 호출하기 위한 function signature</li>
<li><code>parameters</code>: 요청가능한 컨트랙트의 함수를 호출하기 위한 파라미터</li>
</ul>
<p>이 때 널-계정(NULL_ADDRESS)은 비밀키가 없으며 <code>0x00</code>을 주소로 갖는 어카운트를 의미한다. 이는 요청이 포함된 블록은 누구나 마이닝할 수 있음을 의미한다. 요청들은 모두 루트체인 컨트랙트에 제출되므로 오퍼레이터가 더 이상 자식체인을 운영하지 않더라도 사용자들은 요청을 제출하고 이를 직접 마이닝할 수 있다.</p>
<h3><a class="anchor" aria-hidden="true" id="요청가능한-컨트랙트"></a><a href="#요청가능한-컨트랙트" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>요청가능한 컨트랙트</h3>
<p><strong>요청가능한 컨트랙트(requestable contract)</strong>는 말 그대로 요청을 반영할 수 있는 컨트랙트로, 루트체인과 자식체인에 동일하게 배포된다. 요청가능한 컨트랙트는 다음과 같은 인터페이스가 구현하여 모든 요청들을 반영할 수 있어야 한다.</p>
<pre><code class="hljs css language-solidity"><span class="token keyword">interface</span> <span class="token class-name">Requestable</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">applyEnter</span><span class="token punctuation">(</span><span class="token builtin">bool</span> isRootChain<span class="token punctuation">,</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span><span class="token builtin">address</span> requestor<span class="token punctuation">,</span><span class="token builtin">bytes32</span> trieKey<span class="token punctuation">,</span><span class="token builtin">bytes</span> trieValue<span class="token punctuation">)</span>
    <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">applyExit</span><span class="token punctuation">(</span><span class="token builtin">bool</span> isRootChain<span class="token punctuation">,</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span><span class="token builtin">address</span> requestor<span class="token punctuation">,</span><span class="token builtin">bytes32</span> trieKey<span class="token punctuation">,</span><span class="token builtin">bytes</span> trieValue<span class="token punctuation">)</span>
    <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">applyEscape</span><span class="token punctuation">(</span><span class="token builtin">bool</span> isRootChain<span class="token punctuation">,</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span><span class="token builtin">address</span> requestor<span class="token punctuation">,</span><span class="token builtin">bytes32</span> trieKey<span class="token punctuation">,</span><span class="token builtin">bytes</span> trieValue<span class="token punctuation">)</span>
    <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">applyUndo</span><span class="token punctuation">(</span><span class="token builtin">bool</span> isRootChain<span class="token punctuation">,</span><span class="token builtin">uint256</span> requestId<span class="token punctuation">,</span><span class="token builtin">address</span> requestor<span class="token punctuation">,</span><span class="token builtin">bytes32</span> trieKey<span class="token punctuation">,</span><span class="token builtin">bytes</span> trieValue<span class="token punctuation">)</span>
    <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="진입요청-반영"></a><a href="#진입요청-반영" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>진입요청 반영</h3>
<p>루트체인 컨트랙트는 다음과 같은 순서로 진입 요청을 각 체인에 배포된 요청가능한 컨트랙트에 반영한다.</p>
<p><img src="/docs/assets/learn_advanced_enter.png" alt="apply enter"></p>
<ol>
<li>사용자는 루트체인 컨트랙트에 <code>RootChain.startEnter()</code>를 호출하는 트랜잭션을 전송한다.</li>
<li>루트체인 컨트랙트는 진입요청을 루트체인의 요청가능한 컨트랙트에 반영한다. 만약 이 과정에서 트랜잭션이 실패(reverted)된다면 진입요청은 생성되지 않는다.</li>
<li>2가 올바르게 진행되었다면, 루트체인 컨트랙트는 새로운 진입요청이 생성되었음을 기록한다.</li>
<li>요청에폭에서 오퍼레이터는 여러개의 요청 트랜잭션들을 포함하는 요청 블록을 마이닝한다.</li>
<li>3에서 생성된 진입요청이 반영된 요청 트랜잭션이 자식체인의 요청가능한 컨트랙트에 반영된다.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="퇴장요청-반영"></a><a href="#퇴장요청-반영" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>퇴장요청 반영</h3>
<p>루트체인 컨트랙트는 다음과 같은 순서로 퇴장 요청을 각 체인에 배포된 요청가능한 컨트랙트에 반영한다.</p>
<p><img src="/docs/assets/learn_advanced_exit.png" alt="apply exit"></p>
<ol>
<li>사용자는 루트체인 컨트랙트로 <code>RootChain.startExit()</code>를 호출하는 트랜잭션을 전송한다.</li>
<li>진입요청과는 다르게 퇴장요청은 루트체인 컨트랙트에 즉각적으로 기록되고 요청 트랜잭션의 형태로 요청블록에 포함된다.</li>
<li>요청블록에에 대한 챌린지 기간이 종료된 이후 해당 퇴장요청에 대한 챌린지 기간이 시작된다. 만약 2의 요청 트랜잭션의 실행이 실패했다면 챌린저는 이에 대해 <code>RootChain.challengeExit()</code> 함수를 통해 <a href="#challenge">챌린지</a>할 수 있다.</li>
<li>만약 3에서 챌린지 기간이 챌린지 없이 종료되었다면 사용자는 <code>RootChain.finalizeRequest()</code>를 호출하여 퇴장요청을 완결(finalize)하게 된다. 이를 통해 퇴장요청은 루트체인에 배포된 요청가능한 컨트랙트에 반영된다.</li>
</ol>
<p>핵심은 진입요청의 경우 먼저 루트체인에서 반영한 후에 자식체인에 반영하는 것이고, 퇴장요청의 경우 먼저 자식체인에서 반영하고 문제가 없을 경우에만 루트체인에 반영한다는 것이다.</p>
<h3><a class="anchor" aria-hidden="true" id="탈출-및-무효-요청-반영"></a><a href="#탈출-및-무효-요청-반영" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>탈출 및 무효 요청 반영</h3>
<p>탈출요청과 무효요청은 퇴장요청과 동일한 방식으로 처리되지만, 요청 트랜잭션들이 요청 블록이 아닌 탈출 블록에서 처리된다는 점에서 차이가 있다. 자세한 내용은 <a href="continuous-rebase">Continuous Rebase</a>를 참고하라.</p>
<p><img src="/docs/assets/learn_advanced_request_and_challenge.png" alt="request and challenge"></p>
<h2><a class="anchor" aria-hidden="true" id="챌린지"></a><a href="#챌린지" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>챌린지</h2>
<p>챌린저는 자식체인에 문제가 발생했을 경우 챌린지를 신청하여 자식체인의 정상적인 운영을 강제할 수 있다. 챌린저가 신청할 수 있는 챌린지의 종류는 총 세가지로 다음과 같이 구성된다.</p>
<h3><a class="anchor" aria-hidden="true" id="널-계정-챌린지"></a><a href="#널-계정-챌린지" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>널-계정 챌린지</h3>
<p>널-계정 챌린지(NULL_ADDRESS challenge)는 비요청블록에 NULL-ADDRESS가 <code>sender</code>인 트랜잭션이 포함되었을 경우 제출하는 챌린지이다. 이러한 트랜잭션은 요청 트랜잭션을 의미하므로 요청블록이나 탈출블록이 아닌 비요청블록에 포함되어서는 안된다.</p>
<p>챌린저는 루트체인 컨트랙트에 제출된 비요청블록의 <code>transactionsRoot</code>에 요청 트랜잭션이 포함되었음을 머클증명(merkle proof)를 통해 증명하게 된다.</p>
<h3><a class="anchor" aria-hidden="true" id="퇴장-챌린지"></a><a href="#퇴장-챌린지" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>퇴장 챌린지</h3>
<p>퇴장 챌린지(exit challenge)는 퇴장요청이나 탈출요청이 올바르지 않을 경우 제출하는 챌린지아다. 올바르지 않은 퇴장 혹은 탈출 요청은 자식체인에서 실행이 취소되는데, 이 경우 해당 요청들은 루트체인 컨트랙트에서 삭제되어 루트체인에 반영되지 않아야 한다.</p>
<p>챌린저는 실행결과가 취소된 요청 트랜잭션을 머클 증명을 통해 증명한다. 단, 퇴장 챌린지를 진행하기 위해서는 대상 퇴장요청이나 탈출요청이 반드시 확정되어야만 한다. 그렇지 않을 경우 오퍼레이터의 공격행위로 인해 실제로는 취소되지 않아야 할 요청 트랜잭션이 취소된 것으로 잘못 실행될 수 있기 때문이다.</p>
<h3><a class="anchor" aria-hidden="true" id="연산-챌린지"></a><a href="#연산-챌린지" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>연산 챌린지</h3>
<p>연산 챌린지(computation challenge)는 오퍼레이터가 제출한 모든 종류의 블록에 대해 트랜잭션이 올바르게 실행되지 않았을 경우 제출하는 챌린지이다. 오퍼레이터가 잘못된 <code>stateRoot</code>를 제출하면, <code>blockData</code>, <code>preStateRoot</code>, <code>postStateRoot</code>를 바탕으로 truebit 방식의 검증 게임(verification game)과 같은 방법을 통해 챌린지 될 수 있다.</p>
<p><img src="/docs/assets/learn_advanced_verification_game.png" alt="verification game"></p>
<h3><a class="anchor" aria-hidden="true" id="검증게임"></a><a href="#검증게임" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>검증게임</h3>
<p>truebit이 제안한 검증게임(verification game)의 마지막 단계는 이더리움에서 연산을 한 번 수행하고 실제 output과 예상 output을 비교하는 방법을 사용한다. Plasma EVM은 Ohalo Limited와 Parsec Labs에서 구현해 왔던 EVM 내부에서 EVM을 실행하는 스마트 컨트랙트인 <a href="https://github.com/Onther-Tech/solEVM">solEVM</a>을 사용하여 연산 결과를 검증한다.</p>
<h2><a class="anchor" aria-hidden="true" id="스태미나"></a><a href="#스태미나" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>스태미나</h2>
<p><strong>스태미나(Stamina)</strong> 는 자식체인에서 <strong>위임계정(delegator)</strong> 이 본 트랜잭션 실행 모델을 구동시킬 때 필요한 가스비를 <strong>수임계정(delegatee)</strong> 에게 청구할 때 사용된다. 즉 위임계정(delegator)의 가스비를 수임계정(delegatee)이 스태미나(Stamina)로 지불하여 위임계정의 가스비 부담을 대신하게 된다. 스태미나는 스태미나 컨트랙트(Stamina contract)에 계정 잔액(state balance)을 예치(deposit)함으로써 얻을 수 있는데, 수임계정의 스태미나를 예치한 계정을 <strong>예치 계정(depositor account)</strong> 이라 부른다.</p>
<p>수임계정의 스태미나는 위임계정의 가스비를 구매 하면서 차감된다. 차감된 스태미나는 영원히 사라지는 것이 아니라 일정 기간이 지나면 <strong>회복(recover)</strong> 된다. 스태미나가 회복 되기 위해서는 일정 기간이 필요한데, 이 기간을 <strong>회복 기간(recovery epoch)</strong> 이라 부르고, 다음 기간에서 수임계정에 총 예치된 양만큼의 스태미나가 새롭게 충전된다.</p>
<h3><a class="anchor" aria-hidden="true" id="위임계정-지정"></a><a href="#위임계정-지정" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>위임계정 지정</h3>
<p>수임 계정(delegatee)은 위임 계정(delegator)을 지정할 수 있다. 오직 수임 계정(delegatee)만 위임 계정(delegator)을 지정할 수 있으며, 이 반대로 위임계정(delegator)은 수임 계정(delegatee)을 지정할 수 없다. 더해서 수임 계정(delegatee)은 여럿의 위임 계정(delegator)을 지정할 수 있다.</p>
<p>수임계정이 위임계정을 지정하게 되면 <strong>쌍(pair)</strong> 이 형성되는데 이를 <strong>스태미나 쌍(stamina pair)</strong> 또는 <strong>수수료 위임 쌍(fee-delegate pair)</strong> 이라 부른다. 수임계정(delegatee)는 위임계정(delegator)을 지정하기 위해서 스테미나 컨트랙트의 <code>setDelegator()</code> 함수를 호출한다.</p>
<h3><a class="anchor" aria-hidden="true" id="스태미나-예치인출"></a><a href="#스태미나-예치인출" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>스태미나 예치/인출</h3>
<p>스태미나를 생성하기 위해서는 스태미나 컨트랙트의 <code>deposit()</code>를 호출하여 TON을 예치해야 한다. TON을 예치한 계정은 예치한 금액만큼의 스태미나를 지급받는다. 스태미나를 인출하기 위해서는 스태미나 컨트랙트의 <code>requestWithdrawal()</code>, <code>withdraw()</code> 함수를 호출해야 한다. 이 때 보유한 스태미나는 모두 소각되고 해당 금액만큼의 TON이 인출된다.</p>
<p>스태미나를 인출하는 과정은 두 단계(<a href="https://consensys.github.io/smart-contract-best-practices/recommendations/#favor-pull-over-push-for-external-calls">Favor pull over push payments</a>)로 구성된다.</p>
<ol>
<li><code>requestWithdrawal()</code> 함수 호출: 계정의 스태미나 잔액은 인출을 요청한 양만큼 차감된다.</li>
<li><code>withdraw()</code> 함수 호출: <code>requestWithdrawal()</code> 실행 결과 차감된 스태미나만큼 계정으로 인출한다.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="스태미나-환불회복"></a><a href="#스태미나-환불회복" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>스태미나 환불/회복</h3>
<p>이더리움에서는 트랜잭션 실행 후 남은 가스비는 거래 생성자에게 다시 돌려준다. 이와 마찬가지로 스태미나 또한, 트랜잭션 실행 후에 남은 스태미나를 환불(refund)해준다.</p>
<p>스태미나 컨트랙트의 <code>subtractStamina()</code> 함수는 스태미나를 차감하는 기능을 수행하고, <code>addStamina()</code>는 스태미나를 환불하는 기능을 수행한다. 두 함수 모두 오직 널-계정만이 호출할 수 있다.</p>
<p>사용된 스태미나는 다음 회복 기간에 다시 충전된다. 스태미나 회복은 스태미나가 환불될 때 자동으로 수행된다. 스태미나를 환불하는 과정에서 회복 기간이 경과했는지 확인 후 스태미나를 다시 회복하게 된다. 회복되는 스태미나의 양은 예치한 금액을 초과할 수 없다.</p>
<h3><a class="anchor" aria-hidden="true" id="비위임-실행"></a><a href="#비위임-실행" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>비위임 실행</h3>
<p>비위임 실행(normal execution)은 이더리움의 트랜잭션 처리 과정과 같으며, 다음과 같이 진행된다.</p>
<ol>
<li>트랜잭션 실행자의 잔액 조회</li>
<li>upfront cost 지불 가능 여부 확인</li>
<li>upfront cost 차감</li>
<li>가상머신 실행</li>
<li>남은 가스 환불</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="위임-실행"></a><a href="#위임-실행" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>위임 실행</h3>
<p>위임실행(delegated execution)의 경우 다음과 같이 진행된다.</p>
<ol>
<li>트랜잭션 생성 계정(transactor)과 스태미나 쌍으로 구성된 수임계정이 있는지 확인한다.</li>
</ol>
<ul>
<li>수임계정이 있을 경우
<ol start="2">
<li>수임계정의 gas-upfront cost 지불 가능 여부 확인</li>
<li>수임계정에게서 가스 예산만큼의 스테미나를 차감</li>
<li>트랜잭션 생성 계정의 잔액에서 value-upfront cost 만큼 차감</li>
<li>가상머신 실행</li>
<li>환불된 가스(refunded gas)만큼의 스태미나를 수임계정에게 환불</li>
</ol></li>
</ul>
<ul>
<li>수임계정이 없을 경우
<ol start="2">
<li><a href="child-chain#비위임-실행">비위임 실행</a></li>
</ol></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="참고자료"></a><a href="#참고자료" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고자료</h2>
<ul>
<li><a href="https://onther-tech.github.io/papers/tech-paper-kr.pdf">Plasma EVM(국문)</a></li>
<li><a href="https://youtu.be/gW7FCiBgBI4">Economic Description of Tokamak Network and its Ecosystem - Kevin Jeong(정순형, 철학자)</a></li>
</ul>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2020-3-5 by Jin</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/ko/learn/advanced/root-chain"><span class="arrow-prev">← </span><span>루트체인</span></a><a class="docs-next button" href="/docs/ko/learn/advanced/continuous-rebase"><span>Continuous Rebase</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#오퍼레이터-사용자-챌린저">오퍼레이터, 사용자, 챌린저</a><ul class="toc-headings"><li><a href="#오퍼레이터">오퍼레이터</a></li><li><a href="#사용자">사용자</a></li><li><a href="#챌린저">챌린저</a></li></ul></li><li><a href="#블록과-에폭">블록과 에폭</a></li><li><a href="#블록-제출">블록 제출</a></li><li><a href="#요청과-요청-트랜잭션">요청과 요청 트랜잭션</a><ul class="toc-headings"><li><a href="#요청">요청</a></li><li><a href="#요청-트랜잭션">요청 트랜잭션</a></li><li><a href="#요청가능한-컨트랙트">요청가능한 컨트랙트</a></li><li><a href="#진입요청-반영">진입요청 반영</a></li><li><a href="#퇴장요청-반영">퇴장요청 반영</a></li><li><a href="#탈출-및-무효-요청-반영">탈출 및 무효 요청 반영</a></li></ul></li><li><a href="#챌린지">챌린지</a><ul class="toc-headings"><li><a href="#널-계정-챌린지">널-계정 챌린지</a></li><li><a href="#퇴장-챌린지">퇴장 챌린지</a></li><li><a href="#연산-챌린지">연산 챌린지</a></li><li><a href="#검증게임">검증게임</a></li></ul></li><li><a href="#스태미나">스태미나</a><ul class="toc-headings"><li><a href="#위임계정-지정">위임계정 지정</a></li><li><a href="#스태미나-예치인출">스태미나 예치/인출</a></li><li><a href="#스태미나-환불회복">스태미나 환불/회복</a></li><li><a href="#비위임-실행">비위임 실행</a></li><li><a href="#위임-실행">위임 실행</a></li></ul></li><li><a href="#참고자료">참고자료</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Docs</h5><a href="/docs/ko/learn/basic/tokamak-network">Learn</a><a href="/docs/ko/guides/getting-started/how-to-open-private-testnet-rootchain">Guides</a></div><div><h5>Community</h5><a href="https://discord.gg/8wSpJKz">Discord</a><a href="https://t.me/tokamak_network">Telegram</a><a href="https://twitter.com/ontherinfo">Twitter</a><a href="https://www.facebook.com/OntherInc">Facebook</a></div><div><h5>More</h5><a href="http://blog.onther.io">Onther Blog</a><a href="https://github.com/onther-tech/">Onther GitHub</a></div></section><a href="https://tokamak.network" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/tokamak_white.png" alt="Tokamak Network" width="200%" height="200%"/></a><section class="copyright">Copyright © 2020 Onther Inc.</section></footer></div></body></html>